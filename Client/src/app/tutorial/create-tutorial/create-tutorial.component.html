<div class="container pt-5">    
    <div class="row">
        <div class="col-3 menu">
            <h3 class="text-center fw-bold">Create New Tutorial</h3>
            <hr class="dropdown-divider">
            <div class="col-xs-1 text-center">
                <button
                    class="btn btn-success btn-sm col-8"
                    [disabled]='!createTutorialForm.valid'
                    (click)="onPublishTutorial()" >
                    <span>Publish</span>
                </button>
                <button
                    class="btn btn-warning btn-sm col-8"
                    [disabled]='!createTutorialForm.valid' >
                    <span>Save as draft</span>
                </button>
                <button 
                    class="btn btn-transparent btn-sm col-8 mb-4" 
                    routerLink='/tutorial-list'>
                    <span>Cancel</span>
                </button>
            </div>
            <hr class="dropdown-divider">
            <div class="text-center d-flex flex-column bd-highlight mb-3">
                <span>Words</span>
                <span class="fs-1 fw-bold">{{textWordCount}}</span>
                <span>Charachters</span>
                <span class="fs-1 fw-bold">{{textCharCount}}</span>
            </div>
            <form [formGroup]='createTutorialForm' autocomplete="off">
                <div class="innerdiv mb-3">                    
                    <!-- Title -->
                    <div class="form-group mb-3">
                        <span class="fw-bold">Title</span>
                        <input
                            [class.is-invalid]="createTutorialForm.controls.title.touched && createTutorialForm.controls.title.invalid"
                            class="form-control" 
                            type="text" 
                            formControlName='title' placeholder="Title">
                        <div *ngIf="createTutorialForm.controls.title.touched && createTutorialForm.controls.title.invalid">
                            <div *ngIf="createTutorialF.title.errors.required" class="invalid-feedback d-block">
                                Please provide a title!
                            </div>
                            <div *ngIf="createTutorialF.title.errors.minlength" class="invalid-feedback d-block">
                                Title has to be at least 8 charachters
                            </div>
                        </div>
                    </div>
                    <!-- Category -->
                    <div class="form-group mb-3">
                        <span class="fw-bold">Category</span>
                        <div class="font-small">
                            <div *ngFor="let category of selectedCategory; let last = last" style="display: inline;">
                                <span *ngIf="last">
                                    {{category.text}}<span *ngIf="!last"> > </span> 
                                </span>
                                <span *ngIf="!last" class="text-muted">
                                    {{category.text}}<span *ngIf="!last"> > </span> 
                                </span>
                            </div>
                            <a *ngIf="selectedCategory.length > 0" style="cursor: pointer;" (click)="onRemoveCategories()">
                                <img src="assets/svg/ic_trash.svg" alt="Remove categories">
                            </a>
                        </div>
                        <ngx-dropdown-treeview-select [items]="categories" [(value)]="value" (valueChange)="onCategoryValueChange($event)">
                        </ngx-dropdown-treeview-select>
                        <div *ngIf="createTutorialForm.controls.category.touched && createTutorialForm.controls.category.invalid">
                            <div *ngIf="createTutorialF.category.errors.required" class="invalid-feedback d-block">
                                Please select a category!
                            </div>
                        </div>
                    </div>
                    <!-- Tags -->
                    <div class="form-group mb-3">
                        <span class="fw-bold">Tags</span>
                        <ng-autocomplete
                            style="border-radius: 25 !important;"
                            [data]="tags"
                            [searchKeyword]="keyword"
                            (selected)='selectEvent($event)'
                            (inputChanged)='onChangeSearch($event)'
                            [itemTemplate]="itemTemplate"
                            [notFoundTemplate]="notFoundTemplate"
                            [historyIdentifier]="historyIdentifier"
                            notFoundText="No tags found">
                        </ng-autocomplete>
                        <ng-template #itemTemplate let-item>
                            <a [innerHTML]="item.name"></a>
                        </ng-template>
                        
                        <ng-template #notFoundTemplate let-notFound>
                            <div [innerHTML]="notFound"></div>
                        </ng-template>
                        <div class="font-small chip" *ngFor="let tag of selectedTags">
                            {{tag.name}} <img src="assets/svg/ic_trash.svg" alt="Remove" style="cursor: pointer;" (click)="onRemoveTag(tag.id)">
                        </div>
                    </div>
                </div>    
                <h5 class="fw-bold">Featured image</h5>
                <div class="innerdiv mb-3">
                    <!-- Featured Image -->  
                    <div class="d-flex justify-content-center">
                        <input class="mb-2 custom-file-input" type="file" ng2FileSelect [uploader]="uploader" />  
                    </div>
                    <div style="margin-bottom: 40px" *ngIf="uploader?.queue?.length">
                        <hr class="dropdown-divider mb-2">

                        <span class="fw-bold">Name</span>
                        <p *ngFor="let item of uploader.queue">{{ item?.file?.name }}</p>
                        <span class="fw-bold">Size</span>
                        <p *ngFor="let item of uploader.queue">{{ item?.file?.size/1024/1024 | number:'.2' }} MB</p>

                        <hr class="dropdown-divider mb-2">

                        <div>
                            <div>
                                Queue progress
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" [ngStyle]="{ 'width': uploader.progress + '%' }"></div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center">
                                <button type="button" class="btn btn-success btn-s"
                                        (click)="uploader.uploadAll()" [disabled]="!uploader.getNotUploadedItems().length">
                                    <span class="fa fa-upload"></span> Upload
                                </button>
                                <button type="button" class="btn btn-warning btn-s ms-2"
                                        (click)="uploader.clearQueue()" [disabled]="!uploader.queue.length">
                                    <span class="fa fa-trash"></span> Remove
                                </button>
                            </div>
                        </div>

                    </div>
                    <div *ngIf="featuredImageUrl.length !== 0">
                        <img role="presentation" src="{{featuredImageUrl}}" alt="Featured image">
                    </div>
                </div>            
            </form>
            <h5 class="fw-bold">SEO</h5>
            <div class="innerdiv">
                <form [formGroup]='seoForm' autocomplete="off">
                    <!-- Focus keyphrase -->
                    <div class="form-group mb-3">
                        <span class="fw-bold">Focus keyphrase</span>
                        <input
                            [class.is-invalid]="seoForm.controls.focusKeyphrase.touched && seoForm.controls.focusKeyphrase.invalid"
                            class="form-control" 
                            type="text" 
                            formControlName='focusKeyphrase' placeholder="Focus keyphrase">
                    </div>
                    <!-- SEO Title -->
                    <div class="form-group mb-3">
                        <span class="fw-bold">SEO Title</span>
                        <input
                            [class.is-invalid]="seoForm.controls.seoTitle.touched && seoForm.controls.seoTitle.invalid"
                            class="form-control" 
                            type="text" 
                            formControlName='seoTitle' placeholder="SEO Title">
                    </div>
                    <!-- Slug -->
                    <div class="form-group mb-3">
                        <span class="fw-bold">Slug</span>
                        <input
                            [class.is-invalid]="seoForm.controls.slug.touched && seoForm.controls.slug.invalid"
                            class="form-control" 
                            type="text" 
                            formControlName='slug' placeholder="Slug">
                    </div>
                    <!-- Meta Description -->
                    <div class="form-group mb-3">
                        <span class="fw-bold">Meta Description</span>
                        <textarea
                            [class.is-invalid]="seoForm.controls.metaDescription.touched && seoForm.controls.metaDescription.invalid"
                            class="form-control" 
                            rows="8"
                            formControlName='metaDescription' placeholder="Meta description"></textarea>
                        <small>Length: {{metaDescLength}}</small>
                    </div>
                    <hr class="dropdown-divider">
                    <span class="fw-bold mb-2">SEO Results</span>
                    <!-- NOK -->
                        <!-- Focus keyphrase -->
                        <p *ngIf="seoF.focusKeyphrase.errors?.required" class="text-danger mt-2">
                            <img src="assets/svg/ic_nok.svg" alt="Not OK">
                            <small class="ms-1"><span class="fw-bold">Focus keyphrase</span> shouldn't be empty!</small>
                        </p>
                        <p *ngIf="seoF.focusKeyphrase.errors?.strongEnough" class="text-danger mt-2">
                            <img src="assets/svg/ic_nok.svg" alt="Not OK">
                            <small class="ms-1">Content words in <span class="fw-bold">focus keyphrase</span>: {{keyPhraseContentWordsCount}}</small>
                        </p>
                        <!-- SEO title -->
                        <p *ngIf="seoF.seoTitle.errors?.required" class="text-danger mt-2">
                            <img src="assets/svg/ic_nok.svg" alt="Not OK">
                            <small class="ms-1"><span class="fw-bold">SEO title</span> shouldn't be empty!</small>
                        </p>
                        <p *ngIf="seoF.seoTitle.errors?.startsWithFocusKeyphrase" class="text-danger">
                            <img src="assets/svg/ic_nok.svg" alt="Not OK">
                            <small class="ms-1">The <span class="fw-bold">SEO title</span> doesn't contain at the beginning the focus keyphrase.</small>
                        </p>
                        <!-- Meta Description -->
                        <p *ngIf="seoF.seoTitle.errors?.required" class="text-danger mt-2">
                            <img src="assets/svg/ic_nok.svg" alt="Not OK">
                            <small class="ms-1"><span class="fw-bold">Meta Description</span> shouldn't be empty!</small>
                        </p>
                        <p *ngIf="seoF.metaDescription.errors?.containsFocusKeyphrase" class="text-danger">
                            <img src="assets/svg/ic_nok.svg" alt="Not OK">
                            <small class="ms-1">The <span class="fw-bold">Meta Description</span> doesn't contain the focus keyphrase.</small>
                        </p>
                        <p *ngIf="seoF.metaDescription.errors?.metaDescriptionLength" class="text-danger">
                            <img src="assets/svg/ic_nok.svg" alt="Not OK">
                            <small class="ms-1">The <span class="fw-bold">Meta Description's</span> length has to be between 120 and 156 characters!</small>
                        </p>
                        <!-- Text -->
                        <p *ngIf="textWordCount < 300" class="text-danger">
                            <img src="assets/svg/ic_nok.svg" alt="Not OK">
                            <small class="ms-1">The <span class="fw-bold">Text</span> contains less then 300 characters</small>
                        </p>
                        <p *ngIf="internalLinkCount === 0" class="text-danger">
                            <img src="assets/svg/ic_nok.svg" alt="Not OK">
                            <small class="ms-1">The <span class="fw-bold">Text</span> doesn't contain any internal links</small>
                        </p>
                        <p *ngIf="externalLinkCount === 0" class="text-danger">
                            <img src="assets/svg/ic_nok.svg" alt="Not OK">
                            <small class="ms-1">The <span class="fw-bold">Text</span> doesn't contain any external links</small>
                        </p>
                    <!-- Warning -->
                        <p *ngIf="textWordCount < 1001" class="text-warning">
                            <img src="assets/svg/ic_warning.svg" alt="Warning">
                            <small class="ms-1">The <span class="fw-bold">Text</span> contains less then 1000 characters</small>
                        </p>
                        <p *ngIf="internalLinkCount === 1" class="text-warning">
                            <img src="assets/svg/ic_warning.svg" alt="Warning">
                            <small class="ms-1">The <span class="fw-bold">Text</span> contains only 1 internal link.</small>
                        </p>
                        <p *ngIf="externalLinkCount === 1" class="text-warning">
                            <img src="assets/svg/ic_warning.svg" alt="Warning">
                            <small class="ms-1">The <span class="fw-bold">Text</span> contains only 1 external link.</small>
                        </p>
                    <!-- OK -->
                        <!-- Focus keyphrase -->
                        <p *ngIf="!seoF.focusKeyphrase.errors?.strongEnough" class="text-success">
                            <img src="assets/svg/ic_ok.svg" alt="OK">
                            <small class="ms-1">Content words in <span class="fw-bold">focus keyphrase</span>: {{contentWords}}</small>
                        </p>
                        <!-- SEO title -->
                        <p *ngIf="!seoF.seoTitle.errors?.startsWithFocusKeyphrase" class="text-success">
                            <img src="assets/svg/ic_ok.svg" alt="OK">
                            <small class="ms-1">The exact match of the focus keyphrase appears at the beginning of the <span class="fw-bold">SEO title.</span></small>
                        </p>
                        <!-- Meta Description -->
                        <p *ngIf="!seoF.metaDescription.errors?.containsFocusKeyphrase" class="text-success">
                            <img src="assets/svg/ic_ok.svg" alt="OK">
                            <small class="ms-1">The exact match of the focus keyphrase appears in the <span class="fw-bold">Meta Description.</span></small>
                        </p>
                        <p *ngIf="!seoF.metaDescription.errors?.metaDescriptionLength" class="text-success">
                            <img src="assets/svg/ic_ok.svg" alt="OK">
                            <small class="ms-1">The <span class="fw-bold">Meta Description's</span> length is {{metaDescLength}}.</small>
                        </p>
                        <p *ngIf="textWordCount > 299" class="text-success">
                            <img src="assets/svg/ic_ok.svg" alt="OK">
                            <small class="ms-1">The <span class="fw-bold">Text</span> contains {{textWordCount}} words.</small>
                        </p>
                        <p *ngIf="internalLinkCount > 1" class="text-success">
                            <img src="assets/svg/ic_ok.svg" alt="OK">
                            <small class="ms-1">The <span class="fw-bold">Text</span> contains {{internalLinkCount}} internal links.</small>
                        </p>
                        <p *ngIf="externalLinkCount > 1" class="text-success">
                            <img src="assets/svg/ic_ok.svg" alt="OK">
                            <small class="ms-1">The <span class="fw-bold">Text</span> contains {{externalLinkCount}} external links.</small>
                        </p>
                </form>
            </div>
        </div>
        <div class="col-9 ">
            <form [formGroup]='formTextForm' autocomplete='off'>
                <h5 class="fw-bold">Excerpt</h5>
                <ckeditor
                    id="excerpt"
                    formControlName='excerpt' 
                    [config]="editorConfig" 
                    [editor]="Editor" 
                    style="color: black;"
                    (ready)="onReady($event)" >
                </ckeditor>
                <h5 class="mt-4 fw-bold">Content</h5>
                <ckeditor 
                    id="text"
                    formControlName='content' 
                    [config]="editorConfig" 
                    [editor]="Editor"
                    style="color: black;"
                    (ready)="onReady($event)" >
                </ckeditor>
            </form>
        </div>
    </div>
</div>